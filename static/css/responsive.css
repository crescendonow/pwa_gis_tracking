/* ========================================================================
   PWA GIS Online Tracking — Responsive CSS
   ========================================================================
   เพิ่มไว้หลัง style.css ใน <head> ของ dashboard.html และ detail.html:
   <link rel="stylesheet" href="/pwa_gis_tracking/static/css/responsive.css">
   ======================================================================== */

/* ─────────────────────────────────────────────────────────
   1. Mobile Navigation — Hamburger Menu
   ───────────────────────────────────────────────────────── */
.mobile-menu-btn {
    display: none;
    background: none;
    border: 1px solid var(--border, rgba(255,255,255,0.1));
    border-radius: 8px;
    padding: 8px 12px;
    color: var(--text-primary, #F1F5F9);
    font-size: 18px;
    cursor: pointer;
    transition: background 0.2s;
    -webkit-tap-highlight-color: transparent;
    z-index: 101;
}
.mobile-menu-btn:active {
    background: rgba(255,255,255,0.06);
}

/* ── Tablet & below: show hamburger, convert nav to dropdown ── */
@media (max-width: 768px) {
    .mobile-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Nav container needs relative for dropdown */
    .top-nav > div {
        position: relative;
        flex-wrap: wrap;
    }

    /* Nav links — hidden by default, shown via .show class */
    #navLinks {
        display: none !important;
        position: absolute;
        top: 100%;
        left: -16px;
        right: -16px;
        background: var(--surface-1, #111827);
        border-top: 1px solid var(--border, rgba(255,255,255,0.06));
        border-bottom: 1px solid var(--border, rgba(255,255,255,0.06));
        padding: 8px 12px;
        flex-direction: column !important;
        gap: 4px !important;
        z-index: 100;
        box-shadow: 0 12px 32px rgba(0,0,0,0.35);
    }
    #navLinks.show {
        display: flex !important;
    }

    .nav-link {
        padding: 12px 16px !important;
        border-radius: 8px;
        font-size: 14px;
        width: 100%;
        justify-content: flex-start;
    }
    .nav-link:active {
        background: rgba(255,255,255,0.05);
    }

    /* Brand area — compact on mobile */
    .nav-brand h1 {
        font-size: 14px !important;
    }
    .nav-brand span {
        font-size: 10px !important;
        display: none;      /* ซ่อนคำอธิบายย่อยบนมือถือ */
    }
    .logo-icon {
        width: 32px !important;
        height: 32px !important;
        font-size: 11px !important;
    }
}

@media (max-width: 480px) {
    .nav-brand h1 {
        font-size: 12px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   2. Filter Panel — Stack on Mobile
   ───────────────────────────────────────────────────────── */
@media (max-width: 1024px) {
    .filter-panel .flex.flex-wrap.items-center.justify-between {
        flex-direction: column;
        align-items: stretch;
    }
    .filter-panel .flex.flex-wrap.items-center.gap-4 {
        flex-wrap: wrap;
    }
    .filter-group {
        min-width: 130px;
        flex: 1 1 calc(33% - 16px);
    }
}

@media (max-width: 768px) {
    .filter-group {
        flex: 1 1 calc(50% - 8px);
    }
}

@media (max-width: 640px) {
    .filter-panel {
        padding: 12px !important;
    }
    .filter-group {
        flex: 1 1 100%;
    }
    /* ป้องกัน iOS zoom เมื่อ focus (ต้อง ≥ 16px) */
    .filter-group select,
    .filter-group input,
    select,
    input[type="text"],
    input[type="password"],
    textarea {
        font-size: 16px !important;
        min-height: 44px;
    }
    .filter-panel .btn {
        width: 100%;
        justify-content: center;
        min-height: 44px;
        font-size: 14px;
    }
    .filter-panel .flex.items-center.gap-2:last-child {
        width: 100%;
    }
    .filter-panel .btn-gold {
        width: 100%;
    }
}


/* ─────────────────────────────────────────────────────────
   3. Stats Cards — Responsive Grid
   ───────────────────────────────────────────────────────── */
@media (max-width: 1024px) and (min-width: 769px) {
    #statsCards {
        grid-template-columns: repeat(4, 1fr) !important;
    }
}

@media (max-width: 768px) {
    #statsCards,
    #detailStats {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 8px !important;
    }
    .stat-card {
        padding: 12px 14px !important;
    }
    .stat-value {
        font-size: 1.15rem !important;
    }
    .stat-label {
        font-size: 0.65rem !important;
    }
}

@media (max-width: 400px) {
    #statsCards,
    #detailStats {
        gap: 6px !important;
    }
    .stat-card {
        padding: 10px !important;
    }
    .stat-value {
        font-size: 1rem !important;
    }
}


/* ─────────────────────────────────────────────────────────
   4. Dashboard 12-Column Grid — Stack on Tablet/Mobile
   ───────────────────────────────────────────────────────── */
@media (max-width: 1024px) {
    .grid.grid-cols-1.lg\:grid-cols-12 {
        grid-template-columns: 1fr !important;
    }
    .lg\:col-span-3,
    .lg\:col-span-4,
    .lg\:col-span-5,
    .lg\:col-span-8 {
        grid-column: span 1 !important;
    }
}


/* ─────────────────────────────────────────────────────────
   5. Zone Sidebar — Grid Layout on smaller screens
   ───────────────────────────────────────────────────────── */
@media (max-width: 1024px) and (min-width: 641px) {
    .zone-list {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr);
        gap: 4px;
        padding: 8px;
    }
    .zone-item {
        margin: 0 !important;
        font-size: 12px;
    }
}

@media (max-width: 640px) {
    .zone-list {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr);
        gap: 4px;
        padding: 8px;
    }
    .zone-item {
        margin: 0 !important;
        padding: 8px 10px !important;
        font-size: 11px;
    }
}

@media (max-width: 400px) {
    .zone-list {
        grid-template-columns: 1fr;
    }
}


/* ─────────────────────────────────────────────────────────
   6. Tables — Horizontal Scroll + Sticky Columns
   ───────────────────────────────────────────────────────── */
.table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    position: relative;
}

@media (max-width: 1024px) {
    .data-table {
        font-size: 12px;
    }
    .data-table th,
    .data-table td {
        padding: 8px 8px !important;
        white-space: nowrap;
    }
}

@media (max-width: 768px) {
    .data-table {
        font-size: 11px;
    }
    .data-table th,
    .data-table td {
        padding: 7px 6px !important;
    }

    /* Full table: sticky columns #, รหัส, ชื่อ */
    #fullTable th:nth-child(1),
    #fullTable td:nth-child(1) {
        position: sticky;
        left: 0;
        z-index: 3;
        background: var(--surface-1, #111827);
    }
    #fullTable th:nth-child(2),
    #fullTable td:nth-child(2) {
        position: sticky;
        left: 32px;
        z-index: 3;
        background: var(--surface-1, #111827);
    }
    #fullTable th:nth-child(3),
    #fullTable td:nth-child(3) {
        position: sticky;
        left: 96px;
        z-index: 3;
        background: var(--surface-1, #111827);
    }

    /* Shadow hint ขอบขวาของ sticky columns */
    #fullTable th:nth-child(3)::after,
    #fullTable td:nth-child(3)::after {
        content: '';
        position: absolute;
        top: 0;
        right: -6px;
        bottom: 0;
        width: 6px;
        background: linear-gradient(to right, rgba(0,0,0,0.15), transparent);
        pointer-events: none;
    }
}

/* Touch-friendly row height */
@media (hover: none) and (pointer: coarse) {
    .data-table td {
        min-height: 44px;
        line-height: 1.8;
    }
}


/* ─────────────────────────────────────────────────────────
   7. Branch Sidebar Table Height
   ───────────────────────────────────────────────────────── */
@media (max-width: 1024px) {
    .table-wrapper[style*="max-height:560px"] {
        max-height: 300px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   8. Cards — Mobile Padding
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    .card-body {
        padding: 12px !important;
    }
    .card-body.p-0,
    .card-body[style*="padding:0"],
    .card-body[style*="padding: 0"] {
        padding: 0 !important;
    }
    .card-header {
        padding: 12px 14px !important;
        flex-wrap: wrap;
        gap: 6px;
    }
    .card-header h3 {
        font-size: 13px !important;
    }
    .badge {
        font-size: 10px !important;
        padding: 2px 6px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   9. Maps — Responsive Height
   ───────────────────────────────────────────────────────── */
@media (max-width: 768px) {
    #zoneMap {
        height: 300px !important;
    }
    #detailMap {
        height: 380px !important;
    }
}

@media (max-width: 480px) {
    #zoneMap {
        height: 240px !important;
    }
    #detailMap {
        height: 300px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   10. Charts — Full Width on Mobile
   ───────────────────────────────────────────────────────── */
@media (max-width: 768px) {
    .chart-container {
        max-width: 100% !important;
        margin: 0 auto;
    }
    .chart-container canvas {
        max-height: 250px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   11. Pagination — Stack on Mobile
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    #fullTablePagination {
        flex-direction: column !important;
        gap: 8px;
        padding: 10px 12px;
        text-align: center;
    }
    #fullTablePagination > div:last-child {
        width: 100%;
        display: flex;
        justify-content: center;
    }
}


/* ─────────────────────────────────────────────────────────
   12. Detail Page — Filter Grid (6 columns → 2 → 1)
   ───────────────────────────────────────────────────────── */
@media (max-width: 768px) {
    .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-6 {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px !important;
    }
    .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-6 > div:last-child {
        grid-column: span 2;
    }
}

@media (max-width: 480px) {
    .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-6 {
        grid-template-columns: 1fr !important;
    }
    .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-6 > div:last-child {
        grid-column: span 1;
    }
}


/* ─────────────────────────────────────────────────────────
   13. Detail Page — Export Section
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    .grid.grid-cols-1.md\:grid-cols-2 .btn {
        width: 100%;
        justify-content: center;
    }
    .grid.grid-cols-1.md\:grid-cols-2 select {
        font-size: 16px !important;
        min-height: 44px;
    }
}


/* ─────────────────────────────────────────────────────────
   14. MapLibre Popup — Mobile
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    .maplibregl-popup-content {
        max-width: 280px !important;
        max-height: 320px !important;
        font-size: 12px;
    }
    .popup-header {
        font-size: 12px !important;
        padding: 8px 10px !important;
    }
    .popup-body {
        font-size: 11px !important;
        padding: 6px 10px !important;
    }
    .map-footer {
        flex-direction: column;
        gap: 4px;
        padding: 6px 12px !important;
        text-align: center;
    }
}


/* ─────────────────────────────────────────────────────────
   15. Leaflet Popup + Tooltip — Mobile
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    .leaflet-popup-content {
        max-width: 240px !important;
        font-size: 12px;
    }
    .branch-tooltip {
        max-width: 220px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   16. Loading Overlay
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    .loading-overlay .spinner {
        width: 36px !important;
        height: 36px !important;
    }
    .loading-text {
        font-size: 13px !important;
    }
    .loading-progress {
        font-size: 11px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   17. Empty State (Detail page)
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    #emptyState {
        padding: 40px 16px !important;
    }
    #emptyState h3 {
        font-size: 15px !important;
    }
    #emptyState p {
        font-size: 12px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   18. Main Content + Footer
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    main.max-w-screen-2xl {
        padding-left: 8px !important;
        padding-right: 8px !important;
        padding-top: 12px !important;
    }
    footer {
        padding: 12px 8px !important;
    }
    footer p {
        font-size: 10px !important;
    }
}

/* iPhone safe area (notch / home indicator) */
@supports (padding-bottom: env(safe-area-inset-bottom)) {
    body {
        padding-bottom: env(safe-area-inset-bottom);
    }
}


/* ─────────────────────────────────────────────────────────
   19. Table Search Input
   ───────────────────────────────────────────────────────── */
@media (max-width: 640px) {
    #tableSearch {
        min-width: 100% !important;
        font-size: 16px !important;
        min-height: 40px;
    }
}


/* ─────────────────────────────────────────────────────────
   20. Touch-Friendly Targets (WCAG 2.5.8)
   ───────────────────────────────────────────────────────── */
@media (hover: none) and (pointer: coarse) {
    .btn, .nav-link, .zone-item, button, select {
        min-height: 44px;
    }
    .zone-map-marker div {
        width: 48px !important;
        height: 48px !important;
        font-size: 16px !important;
    }
}


/* ─────────────────────────────────────────────────────────
   21. Print Styles
   ───────────────────────────────────────────────────────── */
@media print {
    .top-nav,
    .filter-panel,
    .loading-overlay,
    .mobile-menu-btn,
    footer,
    .btn,
    #zoneMap,
    #detailMap,
    .chart-container,
    #fullTablePagination,
    #emptyState {
        display: none !important;
    }
    body {
        background: #fff !important;
        color: #000 !important;
        padding: 0 !important;
    }
    .card {
        break-inside: avoid;
        border: 1px solid #ccc !important;
        box-shadow: none !important;
        background: #fff !important;
    }
    .data-table th,
    .data-table td {
        color: #000 !important;
        border-color: #ccc !important;
    }
}